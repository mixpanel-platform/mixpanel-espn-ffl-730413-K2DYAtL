<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="app.css">
    <link rel="stylesheet" type="text/css" href="simple-line-icons.css">
    <link rel="stylesheet" type="text/css" href="weather-icons.css">
    <link rel="stylesheet" type="text/css" href="font-awesome.min.css">
    <script src="//cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
    <script src="md5.js"></script>
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css">


  </head>
  <body class="mixpanel-platform-body">
  <div class="content-wrapper">
            <div class="content-heading">
               <!-- START Language list-->
               <div class="pull-right">
               </div>
               <!-- END Language list    -->
               ESPN's Real-Time User Dashboard
               <small data-localize="dashboard.WELCOME"></small>
            </div>
            <!-- START widgets box-->
            <div class="row">
               <div class="col-lg-3 col-sm-6">
                  <!-- START widget-->
                  <div class="panel widget bg-primary">
                     <div class="row row-table">
                        <div class="col-xs-4 text-center bg-primary-dark pv-lg">
                           <!--<em class="icon-cloud-upload fa-3x"></em>-->
                        </div>
                        <div class="col-xs-8 pv-lg">
                           <div class="h2 mt0 current-users">0</div>
                           <div class="text-uppercase">Current Users</div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="col-lg-3 col-sm-6">
                  <!-- START widget-->
                  <div class="panel widget bg-purple">
                     <div class="row row-table">
                        <div class="col-xs-4 text-center bg-purple-dark pv-lg">
                           <!--<em class="icon-globe fa-3x"></em>-->
                        </div>
                        <div class="col-xs-8 pv-lg">
                           <div class="h2 mt0 monthly-actives">0
                              <!--<small>GB</small>-->
                           </div>
                           <div class="text-uppercase">Monthly Actives</div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="col-lg-3 col-md-6 col-sm-12">
                  <!-- START widget-->
                  <div class="panel widget bg-green">
                     <div class="row row-table">
                        <div class="col-xs-4 text-center bg-green-dark pv-lg">
                           <!--<em class="icon-bubbles fa-3x"></em>-->
                        </div>
                        <div class="col-xs-8 pv-lg">
                           <div class="h2 mt0 daily-actives">0</div>
                           <div class="text-uppercase">Daily Actives</div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="col-lg-3 col-md-6 col-sm-12">
                  <!-- START date widget-->
                  <div class="panel widget">
                     <div class="row row-table">
                        <div class="col-xs-4 text-center bg-green pv-lg">
                           <!-- See formats: https://docs.angularjs.org/api/ng/filter/date-->
                           <div data-now="" data-format="MMMM" class="text-sm date-month"></div>
                           <br>
                           <div data-now="" data-format="D" class="h2 mt0 date-day"></div>
                        </div>
                        <div class="col-xs-8 pv-lg">
                           <div data-now="" data-format="dddd" class="text-uppercase date-actual-day"></div>
                           <br>
                           <div data-now="" data-format="h:mm" class="h2 mt0 date-time"></div>
                           <div data-now="" data-format="a" class="text-muted text-sm date-pm"></div>
                        </div>
                     </div>
                  </div>
                  <!-- END date widget    -->
               </div>
            </div>

          <div class="row">
                  <div class="col-lg-12">
                     <div class="panel panel-default">
                        <div class="panel-heading">
                           Data Tables |
                           <small>Zero Configuration</small>
                        </div>
                        <div class="panel-body">
                           <div id="datatable1_wrapper" class="dataTables_wrapper form-inline no-footer"><div class="row"><div class="col-xs-6"><div class="dataTables_length" id="datatable1_length"><label><select name="datatable1_length" aria-controls="datatable1" class="form-control input-sm"><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> records per page</label></div></div><div class="col-xs-6"><div id="datatable1_filter" class="dataTables_filter"><label>Search all columns:<input type="search" class="form-control input-sm" placeholder="" aria-controls="datatable1"></label></div></div></div><table id="datatable1" class="table table-striped table-hover dataTable no-footer" role="grid" aria-describedby="datatable1_info">
                              <thead>
                                 <tr role="row"><th class="sorting_asc" tabindex="0" aria-controls="datatable1" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending" style="width: 161px;">Rendering engine</th><th class="sorting" tabindex="0" aria-controls="datatable1" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending" style="width: 237px;">Browser</th><th class="sorting" tabindex="0" aria-controls="datatable1" rowspan="1" colspan="1" aria-label="Platform(s): activate to sort column ascending" style="width: 211px;">Platform(s)</th><th class="sort-numeric sorting" tabindex="0" aria-controls="datatable1" rowspan="1" colspan="1" aria-label="Engine version: activate to sort column ascending" style="width: 135px;">Engine version</th><th class="sort-alpha sorting" tabindex="0" aria-controls="datatable1" rowspan="1" colspan="1" aria-label="CSS grade: activate to sort column ascending" style="width: 97px;">CSS grade</th></tr>
                              </thead>
                              <tbody>
                              <tr class="gradeA odd" role="row">
                                    <td class="sorting_1">Gecko</td>
                                    <td>Firefox 1.0</td>
                                    <td>Win 98+ / OSX.2+</td>
                                    <td>1.7</td>
                                    <td>A</td>
                                 </tr><tr class="gradeA even" role="row">
                                    <td class="sorting_1">Gecko</td>
                                    <td>Firefox 1.5</td>
                                    <td>Win 98+ / OSX.2+</td>
                                    <td>1.8</td>
                                    <td>A</td>
                                 </tr><tr class="gradeA odd" role="row">
                                    <td class="sorting_1">Gecko</td>
                                    <td>Firefox 2.0</td>
                                    <td>Win 98+ / OSX.2+</td>
                                    <td>1.8</td>
                                    <td>A</td>
                                 </tr><tr class="gradeA even" role="row">
                                    <td class="sorting_1">Gecko</td>
                                    <td>Firefox 3.0</td>
                                    <td>Win 2k+ / OSX.3+</td>
                                    <td>1.9</td>
                                    <td>A</td>
                                 </tr><tr class="gradeA odd" role="row">
                                    <td class="sorting_1">Gecko</td>
                                    <td>Camino 1.0</td>
                                    <td>OSX.2+</td>
                                    <td>1.8</td>
                                    <td>A</td>
                                 </tr><tr class="gradeA even" role="row">
                                    <td class="sorting_1">Gecko</td>
                                    <td>Camino 1.5</td>
                                    <td>OSX.3+</td>
                                    <td>1.8</td>
                                    <td>A</td>
                                 </tr><tr class="gradeA odd" role="row">
                                    <td class="sorting_1">Gecko</td>
                                    <td>Netscape 7.2</td>
                                    <td>Win 95+ / Mac OS 8.6-9.2</td>
                                    <td>1.7</td>
                                    <td>A</td>
                                 </tr><tr class="gradeA even" role="row">
                                    <td class="sorting_1">Gecko</td>
                                    <td>Netscape Browser 8</td>
                                    <td>Win 98SE+</td>
                                    <td>1.7</td>
                                    <td>A</td>
                                 </tr><tr class="gradeA odd" role="row">
                                    <td class="sorting_1">Gecko</td>
                                    <td>Netscape Navigator 9</td>
                                    <td>Win 98+ / OSX.2+</td>
                                    <td>1.8</td>
                                    <td>A</td>
                                 </tr><tr class="gradeA even" role="row">
                                    <td class="sorting_1">Gecko</td>
                                    <td>Mozilla 1.0</td>
                                    <td>Win 95+ / OSX.1+</td>
                                    <td>1</td>
                                    <td>A</td>
                                 </tr></tbody>
                           </table><div class="row"><div class="col-xs-6"><div class="dataTables_info" id="datatable1_info" role="status" aria-live="polite">Showing 1 to 10 of 57 entries</div></div><div class="col-xs-6"><div class="dataTables_paginate paging_simple_numbers" id="datatable1_paginate"><ul class="pagination"><li class="paginate_button previous disabled" aria-controls="datatable1" tabindex="0" id="datatable1_previous"><a href="#">Previous</a></li><li class="paginate_button active" aria-controls="datatable1" tabindex="0"><a href="#">1</a></li><li class="paginate_button " aria-controls="datatable1" tabindex="0"><a href="#">2</a></li><li class="paginate_button " aria-controls="datatable1" tabindex="0"><a href="#">3</a></li><li class="paginate_button " aria-controls="datatable1" tabindex="0"><a href="#">4</a></li><li class="paginate_button " aria-controls="datatable1" tabindex="0"><a href="#">5</a></li><li class="paginate_button " aria-controls="datatable1" tabindex="0"><a href="#">6</a></li><li class="paginate_button next" aria-controls="datatable1" tabindex="0" id="datatable1_next"><a href="#">Next</a></li></ul></div></div></div></div>
                        </div>
                     </div>
                  </div>
               </div>
    </div>



    <script>
        /* Also, she asked about chartbeat style reports (number of simultaneous users). 
        do you think we could do these with custom reports as well? I imagine it would be just like the number of unique users who sent some selection of events at 
        least once in the last 5 min, or 10 min, or whatever we decided would be our definition of "simultaneity" */
        /* Query Segmentation for a Union of events that have happened in the last minute */

        /* Set API Credentials for localhost development */
        MP.api.setCredentials('802636634bb7c18bc2c0dd98ac537072','a60273cdfb3c62ff4ea232b6908499b9')

        /* Get top events */

        events = [];
        MP.api.topEvents().done(function(results) {
          _.each(_.values(results.values()), function(value){
              events.push(value);
          })
          refresh();
        });


        var refresh = function(){
          /* Get total event counts */
            var query = MP.api.query('/api/2.0/events/', {event:events, unit: 'minute', union: 1, type:'unique'}, {dataType: 'json'})
            query.done(function(json) {
              var values = json.data.values;
              var data = _.values(json.data.values)[0];

              /* iterate through the keys in the values dictionary in reverse order.  grab the first and second that have data*/
              var sortedKeys = _.keys(data)

              /* sort and reverse */
              sortedKeys.sort()
              sortedKeys.reverse()
              var current = 0
              var lastMinute = 0
              var count = 0

              while (count <= sortedKeys.length) {
                  if (data[sortedKeys[count]] > 0) {
                      console.log(sortedKeys[count])
                      console.log(sortedKeys[count + 1])
                      current = data[sortedKeys[count]]
                      try {
                          lastMinute = data[sortedKeys[count + 1]]
                      } catch (err){
                          lastMinute = data[sortedKeys[0]]
                      }
                      break;
                  }
                  count ++
              }
              console.log(current, lastMinute)
              var totalCurrentUsers = current + lastMinute;
              $('.current-users').text(totalCurrentUsers.toString());
              /* Show this now */

            })
            /* Query for Monthly Active Users */
            var monthlyQuery = MP.api.query('/api/2.0/events/', {event:events, unit: 'month', union: 1, type:'unique'}, {dataType: 'json'}) 
            monthlyQuery.done(function(json){
                console.log(json)
                var data = _.values(json.data.values)
                var monthlyActives = _.values(data[0])[0]

                $('.monthly-actives').text(monthlyActives.toString());
            });

            var dailyQuery = MP.api.query('/api/2.0/events/', {event:events, unit: 'day', union: 1, interval:1, type:'unique'}, {dataType: 'json'});
            dailyQuery.done(function(json){

                var data = _.values(json.data.values)[0];
                var dataKeys = _.keys(data).sort().reverse()
                var dailyActives = data[dataKeys[0]];
                console.log(dailyActives);
                $('.daily-actives').text(dailyActives.toString());
            })
            /* Date Refresh */
            var date = new Date();
            var day = date.getDate()
            var hours = date.getHours()
            var ampm = hours >= 12 ? 'pm' : 'am';
            var time = date.getHours().toString() + ':' + pad(date.getMinutes()).toString();
            var month = getCurrentMonth();
            var actualDay = getCurrentDay();

            $('.date-month').text(month);
            $('.date-actual-day').text(actualDay);
            $('.date-day').text(day.toString());
            $('.date-time').text(time);
            $('.date-pm').text(ampm);


        }

        setInterval(refresh, 30000);

        function pad(d) {
            return (d < 10) ? '0' + d.toString() : d.toString();
        }


        function getCurrentMonth(){

            var d = new Date();

            var month = new Array();
            month[0] = "January";
            month[1] = "February";
            month[2] = "March";
            month[3] = "April";
            month[4] = "May";
            month[5] = "June";
            month[6] = "July";
            month[7] = "August";
            month[8] = "September";
            month[9] = "October";
            month[10] = "November";
            month[11] = "December";
            var n = month[d.getMonth()];

            return n;
        }

        function getCurrentDay(){
            var d = new Date();
            var weekday = new Array(7);
            weekday[0]=  "Sunday";
            weekday[1] = "Monday";
            weekday[2] = "Tuesday";
            weekday[3] = "Wednesday";
            weekday[4] = "Thursday";
            weekday[5] = "Friday";
            weekday[6] = "Saturday";

            var n = weekday[d.getDay()];
            return n;
        }

    </script>
  </body>
</html>
